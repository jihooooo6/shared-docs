<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>굿프렌즈(GOOD Friends) 서비스 플로우 분석서</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; background: #f5f6fa; line-height: 1.7; color: #2d3436; }

        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }

        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 60px 40px; border-radius: 20px; margin-bottom: 40px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 15px; }
        .header .subtitle { font-size: 1.2em; opacity: 0.9; margin-bottom: 20px; }
        .header .meta { display: flex; justify-content: center; gap: 30px; font-size: 0.95em; opacity: 0.85; }

        /* Section */
        .section { background: white; border-radius: 16px; padding: 40px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); }
        .section-header { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f1f2f6; }
        .section-number { background: #667eea; color: white; width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.3em; }
        .section-title { font-size: 1.5em; color: #2d3436; }

        /* Flow Diagram */
        .flow-diagram { background: linear-gradient(to right, #f8f9fa, #fff, #f8f9fa); border-radius: 12px; padding: 30px; margin: 25px 0; overflow-x: auto; }
        .flow-row { display: flex; align-items: center; justify-content: center; gap: 8px; flex-wrap: wrap; margin: 15px 0; }
        .flow-box { padding: 14px 22px; border-radius: 10px; font-size: 14px; font-weight: 600; text-align: center; min-width: 130px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .flow-arrow { color: #a4b0be; font-size: 24px; }
        .flow-arrow-down { display: block; text-align: center; color: #a4b0be; font-size: 24px; margin: 10px 0; }

        .box-user { background: #3498db; color: white; }
        .box-system { background: #2ecc71; color: white; }
        .box-admin { background: #9b59b6; color: white; }
        .box-status { background: #34495e; color: white; }
        .box-warning { background: #e74c3c; color: white; }
        .box-payment { background: #e67e22; color: white; }
        .box-info { background: #00b894; color: white; }

        .flow-label { text-align: center; font-size: 13px; color: #636e72; margin-top: 10px; font-style: italic; }

        /* Cards */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 25px 0; }
        .card { background: #f8f9fa; border-radius: 12px; padding: 25px; border-left: 4px solid #667eea; }
        .card h4 { color: #2d3436; margin-bottom: 12px; font-size: 1.1em; }
        .card p { color: #636e72; font-size: 0.95em; }
        .card.highlight { border-left-color: #e74c3c; background: #fff5f5; }
        .card.success { border-left-color: #00b894; background: #f0fff4; }

        /* Table */
        table { width: 100%; border-collapse: collapse; margin: 20px 0; border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px 18px; text-align: left; }
        th { background: #667eea; color: white; font-weight: 600; }
        td { background: white; border-bottom: 1px solid #f1f2f6; }
        tr:hover td { background: #f8f9fa; }

        /* Status Badge */
        .badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-blue { background: #e3f2fd; color: #1976d2; }
        .badge-green { background: #e8f5e9; color: #388e3c; }
        .badge-red { background: #ffebee; color: #d32f2f; }
        .badge-orange { background: #fff3e0; color: #f57c00; }
        .badge-gray { background: #eceff1; color: #546e7a; }

        /* Info Box */
        .info-box { padding: 20px 25px; border-radius: 10px; margin: 20px 0; }
        .info-box.blue { background: #e3f2fd; border: 1px solid #90caf9; }
        .info-box.green { background: #e8f5e9; border: 1px solid #a5d6a7; }
        .info-box.yellow { background: #fffde7; border: 1px solid #fff59d; }
        .info-box.red { background: #ffebee; border: 1px solid #ef9a9a; }
        .info-box strong { display: block; margin-bottom: 8px; }

        /* Timeline */
        .timeline { position: relative; padding-left: 30px; margin: 25px 0; }
        .timeline::before { content: ''; position: absolute; left: 8px; top: 0; bottom: 0; width: 3px; background: #dfe6e9; border-radius: 3px; }
        .timeline-item { position: relative; margin-bottom: 25px; padding-left: 25px; }
        .timeline-item::before { content: ''; position: absolute; left: -25px; top: 5px; width: 16px; height: 16px; background: #667eea; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 0 3px #667eea; }
        .timeline-item h4 { color: #2d3436; margin-bottom: 5px; }
        .timeline-item p { color: #636e72; font-size: 0.95em; }

        /* Legend */
        .legend { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin: 25px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 13px; }
        .legend-color { width: 20px; height: 20px; border-radius: 5px; }

        /* Summary Box */
        .summary-box { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 30px; border-radius: 15px; margin: 30px 0; }
        .summary-box h3 { margin-bottom: 15px; }
        .summary-box ul { margin-left: 20px; }
        .summary-box li { margin-bottom: 8px; }

        /* Process List */
        .process-list { counter-reset: process; }
        .process-item { display: flex; align-items: flex-start; gap: 20px; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .process-item::before { counter-increment: process; content: counter(process); background: #667eea; color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0; }
        .process-content h4 { color: #2d3436; margin-bottom: 5px; }
        .process-content p { color: #636e72; font-size: 0.95em; }

        /* Actors */
        .actors { display: flex; justify-content: center; gap: 40px; margin: 30px 0; flex-wrap: wrap; }
        .actor { text-align: center; }
        .actor-icon { width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2em; margin: 0 auto 10px; }
        .actor-icon.user { background: #3498db; color: white; }
        .actor-icon.admin { background: #9b59b6; color: white; }
        .actor-icon.system { background: #2ecc71; color: white; }
        .actor-name { font-weight: 600; color: #2d3436; }
        .actor-desc { font-size: 0.85em; color: #636e72; margin-top: 5px; }

        /* Footer */
        .footer { text-align: center; padding: 40px; color: #636e72; font-size: 0.9em; }

        /* Print - PDF 저장 시 스타일 유지 */
        * {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
            color-adjust: exact !important;
        }

        @media print {
            @page {
                size: A4;
                margin: 15mm;
            }

            body {
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .container {
                max-width: 100% !important;
                padding: 0 !important;
            }

            .section {
                box-shadow: none !important;
                border: 1px solid #ccc !important;
                break-inside: avoid;
                page-break-inside: avoid;
            }

            /* 헤더 배경색 유지 */
            .header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                -webkit-print-color-adjust: exact !important;
            }

            /* 플로우 박스 배경색 유지 */
            .flow-box, .box-user, .box-system, .box-admin, .box-status,
            .box-warning, .box-payment, .box-info {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .box-user { background: #3498db !important; color: white !important; }
            .box-system { background: #2ecc71 !important; color: white !important; }
            .box-admin { background: #9b59b6 !important; color: white !important; }
            .box-status { background: #34495e !important; color: white !important; }
            .box-warning { background: #e74c3c !important; color: white !important; }
            .box-payment { background: #e67e22 !important; color: white !important; }
            .box-info { background: #00b894 !important; color: white !important; }

            /* 섹션 번호 배경색 유지 */
            .section-number {
                background: #667eea !important;
                color: white !important;
                -webkit-print-color-adjust: exact !important;
            }

            /* 테이블 헤더 배경색 유지 */
            th {
                background: #667eea !important;
                color: white !important;
                -webkit-print-color-adjust: exact !important;
            }

            /* 배지 배경색 유지 */
            .badge { -webkit-print-color-adjust: exact !important; }
            .badge-blue { background: #e3f2fd !important; color: #1565c0 !important; }
            .badge-green { background: #e8f5e9 !important; color: #2e7d32 !important; }
            .badge-red { background: #ffebee !important; color: #c62828 !important; }
            .badge-orange { background: #fff3e0 !important; color: #ef6c00 !important; }
            .badge-gray { background: #eceff1 !important; color: #37474f !important; }

            /* 카드 배경색 유지 */
            .card {
                background: #f5f5f5 !important;
                border-left: 4px solid #667eea !important;
                -webkit-print-color-adjust: exact !important;
            }
            .card.highlight {
                border-left-color: #e74c3c !important;
                background: #fff5f5 !important;
            }
            .card.success {
                border-left-color: #00b894 !important;
                background: #f0fff4 !important;
            }

            /* 정보 박스 배경색 유지 */
            .info-box { -webkit-print-color-adjust: exact !important; }
            .info-box.blue { background: #e3f2fd !important; }
            .info-box.green { background: #e8f5e9 !important; }
            .info-box.yellow { background: #fffde7 !important; }
            .info-box.red { background: #ffebee !important; }

            /* 요약 박스 배경색 유지 */
            .summary-box {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
                color: white !important;
                -webkit-print-color-adjust: exact !important;
            }

            /* 프로세스 아이템 */
            .process-item::before {
                background: #667eea !important;
                color: white !important;
                -webkit-print-color-adjust: exact !important;
            }

            /* 액터 아이콘 */
            .actor-icon { -webkit-print-color-adjust: exact !important; }
            .actor-icon.user { background: #3498db !important; color: white !important; }
            .actor-icon.admin { background: #9b59b6 !important; color: white !important; }
            .actor-icon.system { background: #2ecc71 !important; color: white !important; }

            /* 레전드 색상 */
            .legend-color { -webkit-print-color-adjust: exact !important; }

            /* 글자색 진하게 */
            body, p, td, li { color: #000 !important; }
            .section-title { color: #1a1a1a !important; }
            .card h4 { color: #1a1a1a !important; }
            .card p { color: #333 !important; }
            .flow-label { color: #444 !important; }
            .info-box strong { color: #000 !important; }

            /* 폰트 굵기 강화 */
            h1, h2, h3, h4, strong, th { font-weight: 700 !important; }
            p, td, li { font-weight: 500 !important; }

            /* 플로우 다이어그램 배경 */
            .flow-diagram {
                background: #f8f9fa !important;
                -webkit-print-color-adjust: exact !important;
            }

            /* 화살표 색상 */
            .flow-arrow, .flow-arrow-down { color: #666 !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>굿프렌즈(GOOD Friends)</h1>
            <p class="subtitle">국립오페라단 유료 후원 회원 프로그램 서비스 플로우 분석서</p>
            <div class="meta">
                <span>버전: Final</span>
                <span>작성일: 2025년 12월 27일</span>
                <span>프로젝트: OperaHome</span>
            </div>
        </div>

        <!-- 1. 서비스 개요 -->
        <div class="section">
            <div class="section-header">
                <div class="section-number">1</div>
                <h2 class="section-title">서비스 개요</h2>
            </div>

            <p style="font-size: 1.1em; color: #636e72; margin-bottom: 25px;">
                굿프렌즈(GOOD Friends)는 국립오페라단의 유료 후원 회원 프로그램입니다.
                연회비 200,000원을 납부한 회원에게 정기공연 할인 및 무료 티켓 혜택을 제공합니다.
            </p>

            <div class="card-grid">
                <div class="card">
                    <h4>연회비</h4>
                    <p style="font-size: 1.5em; color: #667eea; font-weight: 700;">200,000원</p>
                    <p>가입일로부터 1년간 유효</p>
                </div>
                <div class="card">
                    <h4>결제 수단</h4>
                    <p><span class="badge badge-blue">신용카드</span> <span class="badge badge-orange">가상계좌</span></p>
                    <p>토스페이먼츠 결제 시스템</p>
                </div>
                <div class="card">
                    <h4>주요 혜택</h4>
                    <p>정기공연 20% 할인</p>
                    <p>S석 무료 티켓 2매 제공</p>
                </div>
                <div class="card">
                    <h4>환불 정책</h4>
                    <p>결제 후 7일 이내</p>
                    <p>혜택 미사용 시 전액 환불</p>
                </div>
            </div>

            <div class="actors">
                <div class="actor">
                    <div class="actor-icon user">U</div>
                    <div class="actor-name">사용자</div>
                    <div class="actor-desc">멤버십 가입, 티켓 신청</div>
                </div>
                <div class="actor">
                    <div class="actor-icon admin">A</div>
                    <div class="actor-name">관리자</div>
                    <div class="actor-desc">티켓 확정, 환불 처리</div>
                </div>
                <div class="actor">
                    <div class="actor-icon system">S</div>
                    <div class="actor-name">시스템</div>
                    <div class="actor-desc">결제 처리, 자동화 기능</div>
                </div>
            </div>
        </div>

        <!-- 2. 전체 서비스 라이프사이클 -->
        <div class="section">
            <div class="section-header">
                <div class="section-number">2</div>
                <h2 class="section-title">전체 서비스 라이프사이클</h2>
            </div>

            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box box-user">회원가입</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-payment">멤버십 결제</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-system">멤버십 활성화</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-user">티켓 신청</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-admin">티켓 확정</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-info">공연 관람</div>
                </div>
                <div class="flow-label">정상 플로우: 가입부터 공연 관람까지</div>
            </div>

            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: #3498db;"></div> 사용자 액션</div>
                <div class="legend-item"><div class="legend-color" style="background: #9b59b6;"></div> 관리자 액션</div>
                <div class="legend-item"><div class="legend-color" style="background: #2ecc71;"></div> 시스템 자동 처리</div>
                <div class="legend-item"><div class="legend-color" style="background: #e67e22;"></div> 결제 관련</div>
                <div class="legend-item"><div class="legend-color" style="background: #34495e;"></div> 상태 변경</div>
            </div>
        </div>

        <!-- 3. 멤버십 가입 플로우 -->
        <div class="section">
            <div class="section-header">
                <div class="section-number">3</div>
                <h2 class="section-title">멤버십 가입 플로우</h2>
            </div>

            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box box-user">홈페이지 로그인</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-user">굿프렌즈 소개 페이지</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-user">약관 동의</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-user">결제 수단 선택</div>
                </div>
                <span class="flow-arrow-down">↓</span>
                <div class="flow-row">
                    <div class="flow-box box-payment">토스페이먼츠 결제</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-system">결제 완료 확인</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-system">멤버십 생성</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-status">굿프렌즈 회원</div>
                </div>
            </div>

            <div class="process-list">
                <div class="process-item">
                    <div class="process-content">
                        <h4>홈페이지 로그인</h4>
                        <p>국립오페라단 홈페이지에 기존 회원 계정으로 로그인합니다.</p>
                    </div>
                </div>
                <div class="process-item">
                    <div class="process-content">
                        <h4>굿프렌즈 가입 페이지 접속</h4>
                        <p>"굿 프렌즈 가입하기" 버튼을 클릭하여 가입 페이지로 이동합니다.</p>
                    </div>
                </div>
                <div class="process-item">
                    <div class="process-content">
                        <h4>약관 동의 및 결제</h4>
                        <p>이용약관에 동의하고 신용카드 또는 가상계좌로 200,000원을 결제합니다.</p>
                    </div>
                </div>
                <div class="process-item">
                    <div class="process-content">
                        <h4>멤버십 활성화</h4>
                        <p>결제 완료 즉시 굿프렌즈 회원이 되어 혜택을 이용할 수 있습니다.</p>
                    </div>
                </div>
            </div>

            <div class="info-box blue">
                <strong>가상계좌 결제 시</strong>
                입금 전까지는 "입금대기" 상태이며, 입금 완료 후 자동으로 멤버십이 활성화됩니다.
            </div>
        </div>

        <!-- 4. 티켓 신청 플로우 -->
        <div class="section">
            <div class="section-header">
                <div class="section-number">4</div>
                <h2 class="section-title">티켓 신청 플로우</h2>
            </div>

            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box box-user">공연 선택</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-system">멤버십 유효성 검증</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-system">환불요청 상태 확인</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-system">잔여 티켓 확인</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-user">티켓 신청</div>
                </div>
                <span class="flow-arrow-down">↓</span>
                <div class="flow-row">
                    <div class="flow-box box-status">신청완료 (APPLIED)</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-admin">관리자 검토</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-status">확정 (CONFIRMED)</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-info">공연 당일 수령</div>
                </div>
            </div>

            <h3 style="margin: 30px 0 15px;">티켓 상태 정의</h3>
            <table>
                <tr>
                    <th style="width: 150px;">상태</th>
                    <th>설명</th>
                    <th style="width: 200px;">다음 가능 상태</th>
                </tr>
                <tr>
                    <td><span class="badge badge-blue">신청완료 (APPLIED)</span></td>
                    <td>사용자가 티켓을 신청한 초기 상태. 관리자 확인 대기 중.</td>
                    <td>확정, 반려, 취소</td>
                </tr>
                <tr>
                    <td><span class="badge badge-green">확정 (CONFIRMED)</span></td>
                    <td>관리자가 티켓을 확정한 상태. 공연 당일 매표소에서 수령 가능.</td>
                    <td>취소 (사용자 요청 시)</td>
                </tr>
                <tr>
                    <td><span class="badge badge-red">반려 (REJECTED)</span></td>
                    <td>관리자가 신청을 반려한 상태. 사유가 함께 안내됨.</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td><span class="badge badge-gray">취소 (CANCELLED)</span></td>
                    <td>사용자 요청 또는 시스템에 의해 취소된 상태.</td>
                    <td>-</td>
                </tr>
            </table>

            <div class="info-box yellow">
                <strong>티켓 신청 제한 조건</strong>
                <ul style="margin: 10px 0 0 20px;">
                    <li>멤버십 유효기간이 만료된 경우 신청 불가</li>
                    <li>환불요청 상태인 경우 신청 불가 (환불취소 후 신청 가능)</li>
                    <li>해당 공연의 신청 기간이 아닌 경우 신청 불가</li>
                </ul>
            </div>
        </div>

        <!-- 5. 환불 플로우 -->
        <div class="section">
            <div class="section-header">
                <div class="section-number">5</div>
                <h2 class="section-title">환불 플로우</h2>
            </div>

            <h3 style="margin-bottom: 20px;">5.1 환불 조건</h3>
            <div class="card-grid">
                <div class="card success">
                    <h4>환불 가능</h4>
                    <ul style="margin-left: 20px; color: #636e72;">
                        <li>결제 완료 상태</li>
                        <li>결제일로부터 7일 이내</li>
                        <li>확정(CONFIRMED) 티켓 없음</li>
                    </ul>
                </div>
                <div class="card highlight">
                    <h4>환불 불가</h4>
                    <ul style="margin-left: 20px; color: #636e72;">
                        <li>결제 후 7일 경과</li>
                        <li>확정(CONFIRMED) 티켓 보유</li>
                        <li>이미 환불 완료된 경우</li>
                    </ul>
                </div>
            </div>

            <h3 style="margin: 30px 0 20px;">5.2 환불 요청 프로세스</h3>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box box-user">환불 신청 버튼 클릭</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-user">환불 사유 입력</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-system">환불요청 상태 변경</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-status">환불요청</div>
                </div>
                <span class="flow-arrow-down">↓</span>
                <div class="flow-row">
                    <div class="flow-box box-admin">관리자 확인</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-payment">토스페이먼츠 취소</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-system">APPLIED 티켓 자동 취소</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-status">환불완료</div>
                </div>
            </div>

            <h3 style="margin: 30px 0 20px;">5.3 환불취소(철회) 프로세스</h3>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box box-status">환불요청 상태</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-user">환불취소 버튼 클릭</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-system">환불요청 사유 삭제</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-status">결제완료 (정상)</div>
                </div>
                <div class="flow-label">관리자 처리 전 사용자가 직접 환불을 철회할 수 있습니다.</div>
            </div>

            <div class="info-box green">
                <strong>환불 처리 시 자동 동작</strong>
                <ul style="margin: 10px 0 0 20px;">
                    <li><strong>APPLIED 티켓 자동 취소:</strong> 신청 상태의 티켓은 모두 자동으로 취소됩니다.</li>
                    <li><strong>이력 저장:</strong> "멤버십 환불로 인한 자동 취소" 사유가 기록됩니다.</li>
                    <li><strong>CONFIRMED 티켓 경고:</strong> 확정 티켓이 있으면 경고가 기록됩니다 (환불은 진행됨).</li>
                </ul>
            </div>

            <div class="info-box yellow">
                <strong>환불요청 상태 제한</strong>
                환불요청 상태에서는 새로운 티켓을 신청할 수 없습니다.
                티켓 신청이 필요하면 환불을 취소(철회)해야 합니다.
            </div>
        </div>

        <!-- 6. 관리자 역할 -->
        <div class="section">
            <div class="section-header">
                <div class="section-number">6</div>
                <h2 class="section-title">관리자 역할</h2>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h4>공연 관리</h4>
                    <p>굿프렌즈 대상 공연 선택 및 티켓 신청 기간 설정</p>
                </div>
                <div class="card">
                    <h4>티켓 신청 관리</h4>
                    <p>신청 내역 확인 및 확정/반려 처리</p>
                </div>
                <div class="card">
                    <h4>멤버십 결제 관리</h4>
                    <p>결제 현황 조회, 환불 요청 처리</p>
                </div>
                <div class="card">
                    <h4>회원 관리</h4>
                    <p>굿프렌즈 회원 정보 조회 및 관리</p>
                </div>
            </div>

            <h3 style="margin: 30px 0 15px;">관리자 주요 처리 흐름</h3>
            <table>
                <tr>
                    <th>업무</th>
                    <th>처리 내용</th>
                    <th>시스템 자동 동작</th>
                </tr>
                <tr>
                    <td>티켓 확정</td>
                    <td>신청 상태 → 확정 상태 변경</td>
                    <td>이력 저장, 회원 알림</td>
                </tr>
                <tr>
                    <td>티켓 반려</td>
                    <td>신청 상태 → 반려 상태 변경 (사유 입력)</td>
                    <td>이력 저장, 회원 알림</td>
                </tr>
                <tr>
                    <td>환불 처리</td>
                    <td>토스페이먼츠 결제 취소 API 호출</td>
                    <td>APPLIED 티켓 자동 취소, 이력 저장</td>
                </tr>
            </table>
        </div>

        <!-- 7. 전체 상태 흐름도 -->
        <div class="section">
            <div class="section-header">
                <div class="section-number">7</div>
                <h2 class="section-title">전체 상태 흐름도</h2>
            </div>

            <h3 style="margin-bottom: 20px;">7.1 멤버십 상태 흐름</h3>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box box-payment">결제 진행</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-status">결제완료</div>
                    <span class="flow-arrow">↔</span>
                    <div class="flow-box box-warning">환불요청</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-status">환불완료</div>
                </div>
                <div class="flow-label">결제완료 ↔ 환불요청: 사용자가 환불취소로 복귀 가능</div>
            </div>

            <h3 style="margin: 30px 0 20px;">7.2 티켓 상태 흐름</h3>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box box-user">티켓 신청</div>
                    <span class="flow-arrow">→</span>
                    <div class="flow-box box-status">APPLIED</div>
                </div>
                <span class="flow-arrow-down">↓</span>
                <div class="flow-row" style="gap: 50px;">
                    <div style="text-align: center;">
                        <div class="flow-box box-admin">관리자 확정</div>
                        <span class="flow-arrow-down">↓</span>
                        <div class="flow-box box-info">CONFIRMED</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="flow-box box-admin">관리자 반려</div>
                        <span class="flow-arrow-down">↓</span>
                        <div class="flow-box box-warning">REJECTED</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="flow-box box-system">사용자/시스템 취소</div>
                        <span class="flow-arrow-down">↓</span>
                        <div class="flow-box box-status">CANCELLED</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 8. 핵심 비즈니스 규칙 -->
        <div class="section">
            <div class="section-header">
                <div class="section-number">8</div>
                <h2 class="section-title">핵심 비즈니스 규칙</h2>
            </div>

            <table>
                <tr>
                    <th style="width: 200px;">규칙</th>
                    <th>상세 설명</th>
                </tr>
                <tr>
                    <td><strong>환불 기간 제한</strong></td>
                    <td>결제일로부터 7일 이내에만 환불 신청 가능</td>
                </tr>
                <tr>
                    <td><strong>혜택 사용 시 환불 불가</strong></td>
                    <td>CONFIRMED 상태의 티켓이 있으면 환불 버튼 비활성화</td>
                </tr>
                <tr>
                    <td><strong>환불요청 시 신청 차단</strong></td>
                    <td>환불요청 상태에서는 새로운 티켓 신청 불가</td>
                </tr>
                <tr>
                    <td><strong>환불 시 자동 취소</strong></td>
                    <td>환불 처리 시 APPLIED 상태 티켓은 자동으로 CANCELLED 변경</td>
                </tr>
                <tr>
                    <td><strong>멤버십 유효기간</strong></td>
                    <td>결제 완료일로부터 정확히 1년간 유효</td>
                </tr>
                <tr>
                    <td><strong>티켓 수량 제한</strong></td>
                    <td>회원 기간 내 S석 무료 티켓 2매 제공</td>
                </tr>
            </table>
        </div>

        <!-- Summary -->
        <div class="summary-box">
            <h3>서비스 요약</h3>
            <ul>
                <li><strong>멤버십:</strong> 연회비 200,000원, 1년 유효, 7일 이내 환불 가능</li>
                <li><strong>티켓:</strong> 신청 → 확정/반려 → 공연 관람 (4가지 상태 관리)</li>
                <li><strong>환불:</strong> 요청 → 처리 (APPLIED 자동 취소), 철회 가능</li>
                <li><strong>자동화:</strong> 환불 시 티켓 자동 취소, 이력 자동 저장</li>
            </ul>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>국립오페라단 굿프렌즈 서비스 플로우 분석서</p>
            <p>작성일: 2025년 12월 27일 | 프로젝트: OperaHome</p>
        </div>
    </div>
</body>
</html>
